<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Administration - Martocci Mayhem Microsites</title>
  <meta name="description" content="Manage and monitor Martocci Mayhem microsite network.">
  <link rel="icon" href="/images/favicon.ico">
  <style>
    :root {
      --mm-bg: radial-gradient(circle at 12% 0%, rgba(59, 130, 246, 0.2), transparent 55%),
        radial-gradient(circle at 85% 10%, rgba(147, 197, 253, 0.16), transparent 62%),
        #04060f;
      --mm-surface: rgba(14, 18, 32, 0.86);
      --mm-surface-strong: rgba(22, 27, 43, 0.92);
      --mm-border: rgba(148, 163, 184, 0.22);
      --mm-border-soft: rgba(148, 163, 184, 0.16);
      --mm-border-strong: rgba(148, 163, 184, 0.36);
      --mm-text-primary: #f8fafc;
      --mm-text-muted: #94a3b8;
      --mm-accent: #fbbf24;
      --mm-accent-soft: rgba(251, 191, 36, 0.18);
      --mm-success: #22c55e;
      --mm-warning: #facc15;
      --mm-danger: #ef4444;
      --mm-shadow-lg: 0 24px 44px rgba(2, 6, 23, 0.35);
      --mm-shadow-md: 0 16px 32px rgba(15, 23, 42, 0.45);
      --mm-radius-lg: 18px;
      --mm-radius-md: 12px;
      --mm-radius-sm: 8px;
    }

    *,
    *::before,
    *::after {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: "Inter", ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
      background: var(--mm-bg);
      color: var(--mm-text-primary);
      min-height: 100vh;
      -webkit-font-smoothing: antialiased;
    }

    a {
      color: inherit;
      text-decoration: none;
    }

    .hero {
      position: relative;
      padding: clamp(32px, 8vw, 72px) clamp(16px, 6vw, 120px) clamp(42px, 6vw, 72px);
      border-bottom: 1px solid var(--mm-border);
      background: linear-gradient(135deg, rgba(8, 47, 73, 0.72), rgba(17, 24, 39, 0.9));
      overflow: hidden;
    }

    .hero::after {
      content: "";
      position: absolute;
      inset: 0;
      background: radial-gradient(circle at top right, rgba(59, 130, 246, 0.22), transparent 55%);
      pointer-events: none;
    }

    .hero__inner {
      position: relative;
      max-width: 1240px;
      margin: 0 auto;
      display: grid;
      gap: clamp(16px, 4vw, 28px);
    }

    .hero__top {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 16px;
      flex-wrap: wrap;
    }

    .brand {
      display: inline-flex;
      align-items: center;
      gap: 12px;
      text-decoration: none;
      color: var(--mm-text-primary);
      font-weight: 700;
      font-size: 1.05rem;
    }

    .brand img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      box-shadow: 0 0 0 2px rgba(251, 191, 36, 0.35);
    }

    .hero__badge {
      display: inline-flex;
      align-items: center;
      gap: 10px;
      padding: 10px 16px;
      border-radius: 999px;
      background: rgba(15, 23, 42, 0.7);
      border: 1px solid var(--mm-border);
      font-size: 0.9rem;
      letter-spacing: 0.08em;
      text-transform: uppercase;
      color: var(--mm-accent);
      font-weight: 600;
      width: fit-content;
    }

    .hero__title {
      margin: 0;
      font-size: clamp(2.6rem, 6vw, 4.4rem);
      font-weight: 800;
      letter-spacing: -0.02em;
      line-height: 1.05;
    }

    .hero__title span {
      color: var(--mm-accent);
    }

    .hero__copy {
      margin: 0;
      max-width: 720px;
      font-size: clamp(1.05rem, 2.5vw, 1.3rem);
      color: var(--mm-text-muted);
      line-height: 1.7;
    }

    .hero__actions {
      display: flex;
      flex-wrap: wrap;
      gap: 14px;
      margin-top: 12px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 12px 20px;
      border-radius: 999px;
      border: 1px solid transparent;
      font-weight: 600;
      font-size: 0.95rem;
      text-decoration: none;
      transition: transform 160ms ease, box-shadow 160ms ease, border-color 160ms ease;
      cursor: pointer;
    }

    .btn--primary {
      background: linear-gradient(135deg, #fbbf24, #f59e0b);
      color: #111827;
      box-shadow: 0 16px 30px rgba(251, 191, 36, 0.35);
    }

    .btn--primary:hover {
      transform: translateY(-2px);
    }

    .btn--ghost {
      background: rgba(15, 23, 42, 0.6);
      border-color: var(--mm-border);
      color: var(--mm-text-primary);
    }

    .btn--ghost:hover {
      border-color: var(--mm-accent);
      color: var(--mm-accent);
    }

    main {
      max-width: 1420px;
      margin: 0 auto;
      padding: clamp(32px, 7vw, 72px) clamp(16px, 5vw, 48px) 120px;
      display: grid;
      gap: clamp(48px, 7vw, 96px);
    }

    .section {
      display: grid;
      gap: 24px;
    }

    .section__head {
      display: flex;
      flex-wrap: wrap;
      align-items: flex-end;
      justify-content: space-between;
      gap: 16px;
    }

    .section__title {
      margin: 0;
      font-size: clamp(1.75rem, 4vw, 2.35rem);
      font-weight: 700;
      letter-spacing: -0.015em;
    }

    .section__subtitle {
      margin: 0;
      color: var(--mm-text-muted);
      font-size: 1rem;
    }

    .admin-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
      gap: 24px;
    }

    .admin-card {
      display: grid;
      gap: 16px;
      padding: 28px;
      border-radius: var(--mm-radius-lg);
      background: var(--mm-surface-strong);
      border: 1px solid var(--mm-border);
      box-shadow: var(--mm-shadow-lg);
      transition: transform 160ms ease, border-color 160ms ease;
    }

    .admin-card:hover {
      transform: translateY(-4px);
      border-color: rgba(251, 191, 36, 0.5);
    }

    .admin-card__header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 12px;
    }

    .admin-card__name {
      font-size: 1.4rem;
      font-weight: 700;
      letter-spacing: -0.01em;
      margin: 0;
    }

    .admin-card__status-badge {
      padding: 6px 12px;
      border-radius: var(--mm-radius-sm);
      font-weight: 700;
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 0.08em;
    }

    .admin-card__status-badge--ok {
      background: rgba(34, 197, 94, 0.14);
      color: #4ade80;
    }

    .admin-card__status-badge--error {
      background: rgba(239, 68, 68, 0.15);
      color: #f87171;
    }

    .admin-card__status-badge--warning {
      background: rgba(250, 204, 21, 0.18);
      color: #facc15;
    }

    .admin-card__info {
      display: grid;
      gap: 8px;
      padding: 16px;
      border-radius: var(--mm-radius-sm);
      background: rgba(15, 23, 42, 0.6);
      border: 1px solid var(--mm-border-soft);
    }

    .admin-card__info-row {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 12px;
      font-size: 0.9rem;
    }

    .admin-card__info-label {
      color: var(--mm-text-muted);
    }

    .admin-card__info-value {
      font-weight: 600;
    }

    .admin-card__actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 8px;
    }

    .admin-card__action {
      flex: 1;
      min-width: 120px;
      padding: 10px 16px;
      border-radius: var(--mm-radius-sm);
      border: 1px solid var(--mm-border);
      background: rgba(15, 23, 42, 0.6);
      color: var(--mm-text-primary);
      font-weight: 600;
      font-size: 0.85rem;
      text-align: center;
      transition: all 160ms ease;
    }

    .admin-card__action:hover {
      border-color: var(--mm-accent);
      background: var(--mm-accent-soft);
      color: var(--mm-accent);
    }

    .admin-card__error {
      padding: 12px;
      border-radius: var(--mm-radius-sm);
      background: rgba(239, 68, 68, 0.1);
      border: 1px solid rgba(239, 68, 68, 0.3);
      color: #f87171;
      font-size: 0.85rem;
      line-height: 1.5;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 24px;
    }

    .stat-card {
      padding: 24px;
      border-radius: var(--mm-radius-md);
      background: var(--mm-surface);
      border: 1px solid var(--mm-border-soft);
      display: grid;
      gap: 8px;
    }

    .stat-card__value {
      font-size: 2.2rem;
      font-weight: 700;
      color: var(--mm-accent);
    }

    .stat-card__label {
      font-size: 0.85rem;
      text-transform: uppercase;
      letter-spacing: 0.12em;
      color: var(--mm-text-muted);
    }

    .loading {
      padding: 32px;
      border-radius: var(--mm-radius-md);
      text-align: center;
      color: var(--mm-text-muted);
      background: rgba(15, 23, 42, 0.6);
      border: 1px dashed var(--mm-border);
    }

    footer {
      border-top: 1px solid var(--mm-border);
      padding: 48px 16px;
      text-align: center;
      color: var(--mm-text-muted);
      font-size: 0.9rem;
    }

    footer a {
      color: var(--mm-accent);
      font-weight: 600;
      text-decoration: none;
    }

    footer a:hover {
      text-decoration: underline;
    }

    @media (max-width: 768px) {
      .admin-grid {
        grid-template-columns: 1fr;
      }

      .stats-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>

<body>
  <header class="hero">
    <div class="hero__inner">
      <div class="hero__top">
        <a class="brand" href="/" rel="noopener">
          <img src="/images/JasonMartocciLogo.webp" alt="Martocci Mayhem logo">
          <span>Martocci Mayhem</span>
        </a>
      </div>

      <span class="hero__badge">Administration Panel</span>
      <h1 class="hero__title">Microsite <span>Management</span></h1>
      <p class="hero__copy">Monitor and manage all Martocci Mayhem microsites from this central administration panel. View status, metrics, and perform maintenance operations.</p>

      <div class="hero__actions">
        <a class="btn btn--ghost" href="/">← Back to Portal</a>
      </div>
    </div>
  </header>

  <main>
    <section class="section">
      <div class="section__head">
        <div>
          <h2 class="section__title">Network Overview</h2>
          <p class="section__subtitle">Real-time statistics across all microsites.</p>
        </div>
      </div>

      <div class="stats-grid" id="stats-grid">
        <div class="stat-card">
          <span class="stat-card__value" id="stat-total-sites">--</span>
          <span class="stat-card__label">Total Sites</span>
        </div>
        <div class="stat-card">
          <span class="stat-card__value" id="stat-active-sites">--</span>
          <span class="stat-card__label">Active Sites</span>
        </div>
        <div class="stat-card">
          <span class="stat-card__value" id="stat-total-videos">--</span>
          <span class="stat-card__label">Total Videos</span>
        </div>
        <div class="stat-card">
          <span class="stat-card__value" id="stat-total-views">--</span>
          <span class="stat-card__label">Total Views</span>
        </div>
      </div>
    </section>

    <section class="section">
      <div class="section__head">
        <div>
          <h2 class="section__title">Microsite Status</h2>
          <p class="section__subtitle">Detailed status and management for each microsite.</p>
        </div>
      </div>

      <div class="admin-grid" id="admin-grid">
        <div class="loading">Loading microsite data...</div>
      </div>
    </section>
  </main>

  <footer>
    <div>© 2025 <a href="https://martoccimayhem.com" target="_blank" rel="noopener">Martocci Mayhem</a> · All rights reserved.</div>
  </footer>

  <script>
    (function () {
      const CHANNELS = [{"slug":"martocci-mayhem","name":"Martocci Mayhem","description":"Loading channel metrics...","createdAt":"2025-11-13T21:36:31.609Z","siteGeneratedAt":"2025-11-13T22:41:25.743Z","siteGenerationError":"Microsite generated with fallback content","siteGenerated":false,"metaSummary":{"mayhemLevel":null,"mayhemScore":null,"totalViews":null,"totalVideos":0,"lastRefresh":null}}];

      const state = {
        channels: [],
        stats: {
          totalSites: 0,
          activeSites: 0,
          totalVideos: 0,
          totalViews: 0,
        },
      };

      const statsElements = {
        totalSites: document.getElementById('stat-total-sites'),
        activeSites: document.getElementById('stat-active-sites'),
        totalVideos: document.getElementById('stat-total-videos'),
        totalViews: document.getElementById('stat-total-views'),
      };

      const adminGrid = document.getElementById('admin-grid');

      function formatNumber(num) {
        const value = Number(num) || 0;
        if (value >= 1000000) return (value / 1000000).toFixed(1).replace(/\.0$/, '') + 'M';
        if (value >= 1000) return (value / 1000).toFixed(1).replace(/\.0$/, '') + 'K';
        return value.toLocaleString();
      }

      function parseDate(value) {
        if (!value) return null;
        const date = new Date(value);
        return Number.isNaN(date.getTime()) ? null : date;
      }

      function formatDateDisplay(date) {
        if (!date) return 'Never';
        return date.toLocaleDateString(undefined, { year: 'numeric', month: 'short', day: 'numeric', hour: '2-digit', minute: '2-digit' });
      }

      function formatRelative(date) {
        if (!date) return 'Unknown';
        const diff = Date.now() - date.getTime();
        const minute = 60000;
        const hour = 3600000;
        const day = 86400000;
        if (diff < minute) return 'Just now';
        if (diff < hour) {
          const mins = Math.round(diff / minute);
          return mins + 'm ago';
        }
        if (diff < day) {
          const hrs = Math.round(diff / hour);
          return hrs + 'h ago';
        }
        const days = Math.round(diff / day);
        return days + 'd ago';
      }

      async function fetchJson(url) {
        const response = await fetch(url, { cache: 'no-store' });
        if (!response.ok) throw new Error('HTTP ' + response.status);
        return response.json();
      }

      async function loadChannel(channelInfo) {
        const result = {
          slug: channelInfo.slug,
          name: channelInfo.name,
          createdAt: parseDate(channelInfo.createdAt),
          siteGeneratedAt: parseDate(channelInfo.siteGeneratedAt),
          siteGenerationError: channelInfo.siteGenerationError || null,
          siteGenerated: Boolean(channelInfo.siteGenerated),
          metaSummary: channelInfo.metaSummary || null,
          videos: [],
          metrics: {
            videoCount: 0,
            totalViews: 0,
            totalLikes: 0,
          },
          status: 'pending',
          lastRefresh: null,
          error: null,
        };

        try {
          const videos = await fetchJson('/' + channelInfo.slug + '/videos.json');
          if (Array.isArray(videos)) {
            result.videos = videos;
            result.metrics.videoCount = videos.length;
            result.metrics.totalViews = videos.reduce((sum, v) => sum + (Number(v.view_count) || 0), 0);
            result.metrics.totalLikes = videos.reduce((sum, v) => sum + (Number(v.like_count) || 0), 0);
            result.status = 'ok';
          } else {
            result.status = 'error';
            result.error = 'Invalid videos.json format';
          }
        } catch (error) {
          result.status = 'error';
          result.error = error instanceof Error ? error.message : 'Unable to load videos.json';
        }

        try {
          const meta = await fetchJson('/' + channelInfo.slug + '/meta.json');
          if (meta && typeof meta === 'object' && meta.generatedAt) {
            result.lastRefresh = parseDate(meta.generatedAt);
          }
        } catch (error) {
          result.lastRefresh = result.siteGeneratedAt || null;
        }

        if (!result.lastRefresh) result.lastRefresh = result.siteGeneratedAt || null;

        state.channels.push(result);
      }

      function createAdminCard(channel) {
        const card = document.createElement('div');
        card.className = 'admin-card';

        const header = document.createElement('div');
        header.className = 'admin-card__header';

        const name = document.createElement('h3');
        name.className = 'admin-card__name';
        name.textContent = channel.name;

        const statusBadge = document.createElement('span');
        statusBadge.className = 'admin-card__status-badge';
        if (channel.status === 'ok') {
          statusBadge.className += ' admin-card__status-badge--ok';
          statusBadge.textContent = 'ONLINE';
        } else if (channel.status === 'error') {
          statusBadge.className += ' admin-card__status-badge--error';
          statusBadge.textContent = 'ERROR';
        } else {
          statusBadge.className += ' admin-card__status-badge--warning';
          statusBadge.textContent = 'PENDING';
        }

        header.append(name, statusBadge);

        const info = document.createElement('div');
        info.className = 'admin-card__info';

        const rows = [
          { label: 'Slug', value: channel.slug },
          { label: 'Videos', value: formatNumber(channel.metrics.videoCount) },
          { label: 'Total Views', value: formatNumber(channel.metrics.totalViews) },
          { label: 'Total Likes', value: formatNumber(channel.metrics.totalLikes) },
          { label: 'Created', value: formatDateDisplay(channel.createdAt) },
          { label: 'Last Refresh', value: channel.lastRefresh ? formatRelative(channel.lastRefresh) : 'Never' },
        ];

        rows.forEach(rowData => {
          const row = document.createElement('div');
          row.className = 'admin-card__info-row';

          const label = document.createElement('span');
          label.className = 'admin-card__info-label';
          label.textContent = rowData.label;

          const value = document.createElement('span');
          value.className = 'admin-card__info-value';
          value.textContent = rowData.value;

          row.append(label, value);
          info.appendChild(row);
        });

        card.append(header, info);

        if (channel.status === 'error' && channel.error) {
          const errorBox = document.createElement('div');
          errorBox.className = 'admin-card__error';
          errorBox.textContent = 'Error: ' + channel.error;
          card.appendChild(errorBox);
        }

        if (channel.siteGenerationError) {
          const warningBox = document.createElement('div');
          warningBox.className = 'admin-card__error';
          warningBox.style.background = 'rgba(250, 204, 21, 0.1)';
          warningBox.style.borderColor = 'rgba(250, 204, 21, 0.3)';
          warningBox.style.color = '#facc15';
          warningBox.textContent = 'Warning: ' + channel.siteGenerationError;
          card.appendChild(warningBox);
        }

        const actions = document.createElement('div');
        actions.className = 'admin-card__actions';

        const viewLink = document.createElement('a');
        viewLink.className = 'admin-card__action';
        viewLink.href = '/' + channel.slug + '/index.html';
        viewLink.target = '_blank';
        viewLink.rel = 'noopener';
        viewLink.textContent = 'View Site';

        const videosLink = document.createElement('a');
        videosLink.className = 'admin-card__action';
        videosLink.href = '/' + channel.slug + '/videos.json';
        videosLink.target = '_blank';
        videosLink.rel = 'noopener';
        videosLink.textContent = 'Videos JSON';

        const metaLink = document.createElement('a');
        metaLink.className = 'admin-card__action';
        metaLink.href = '/' + channel.slug + '/meta.json';
        metaLink.target = '_blank';
        metaLink.rel = 'noopener';
        metaLink.textContent = 'Meta JSON';

        actions.append(viewLink, videosLink, metaLink);
        card.appendChild(actions);

        return card;
      }

      function renderAdminCards() {
        if (!adminGrid) return;
        adminGrid.textContent = '';

        if (!state.channels.length) {
          const empty = document.createElement('div');
          empty.className = 'loading';
          empty.textContent = 'No microsites found.';
          adminGrid.appendChild(empty);
          return;
        }

        state.channels.forEach(channel => {
          adminGrid.appendChild(createAdminCard(channel));
        });
      }

      function updateStats() {
        state.stats.totalSites = state.channels.length;
        state.stats.activeSites = state.channels.filter(c => c.status === 'ok').length;
        state.stats.totalVideos = state.channels.reduce((sum, c) => sum + c.metrics.videoCount, 0);
        state.stats.totalViews = state.channels.reduce((sum, c) => sum + c.metrics.totalViews, 0);

        if (statsElements.totalSites) statsElements.totalSites.textContent = state.stats.totalSites.toString();
        if (statsElements.activeSites) statsElements.activeSites.textContent = state.stats.activeSites.toString();
        if (statsElements.totalVideos) statsElements.totalVideos.textContent = formatNumber(state.stats.totalVideos);
        if (statsElements.totalViews) statsElements.totalViews.textContent = formatNumber(state.stats.totalViews);
      }

      async function initialize() {
        await Promise.all(CHANNELS.map(loadChannel));
        renderAdminCards();
        updateStats();
      }

      initialize().catch(error => {
        console.error('Failed to initialize admin panel:', error);
        if (adminGrid) {
          adminGrid.textContent = '';
          const errorDiv = document.createElement('div');
          errorDiv.className = 'loading';
          errorDiv.textContent = 'Error loading microsite data: ' + error.message;
          adminGrid.appendChild(errorDiv);
        }
      });
    })();
  </script>
</body>

</html>
